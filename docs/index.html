<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peer Support Calendar - Free Tri-County Resources</title>
    <style>
        :root {
            --peer-support: #7B68EE;
            --fitness: #32CD32;
            --events: #FF6347;
            --arts: #9370DB;
            --food: #DAA520;
            --social: #FF69B4;
            --accent: #4a90d9;
        }

        * { box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px 40px;
            background: #fafafa;
            color: #333;
        }

        @media (max-width: 600px) {
            body {
                padding: 16px;
            }
        }

        header {
            text-align: center;
            margin-bottom: 25px;
        }

        header img {
            max-width: 160px;
            height: auto;
        }

        h1 {
            color: #2c3e50;
            margin: 12px 0 6px;
            font-size: 1.5em;
        }

        .tagline {
            color: #666;
            font-size: 1em;
            margin: 0;
        }

        /* How it works */
        .how-it-works {
            background: #e8f4e8;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 20px;
            font-size: 0.95em;
        }

        .how-it-works p {
            margin: 0;
            color: #2d5a2d;
        }

        /* Platform selector */
        .choose-label {
            text-align: center;
            font-weight: 500;
            margin-bottom: 12px;
            color: #444;
        }

        .platform-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .platform-tab {
            flex: 1;
            padding: 12px 8px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.2s;
        }

        .platform-tab:hover {
            border-color: var(--accent);
        }

        .platform-tab.active {
            border-color: var(--accent);
            background: var(--accent);
            color: white;
        }

        /* Calendar list */
        .calendar-section {
            background: white;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .calendar-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .calendar-list li {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .calendar-list li:last-child {
            border-bottom: none;
        }

        .calendar-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .color-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .calendar-name {
            font-weight: 500;
            font-size: 0.95em;
        }

        .copy-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
        }

        .copy-btn:hover { background: #357abd; }
        .copy-btn.copied { background: #27ae60; }

        /* Instructions */
        .instructions {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #eee;
            font-size: 0.9em;
            color: #555;
        }

        .instructions ol {
            margin: 8px 0 0;
            padding-left: 20px;
        }

        .instructions li {
            margin-bottom: 6px;
        }

        /* More options toggle */
        .more-toggle {
            background: none;
            border: none;
            color: var(--accent);
            cursor: pointer;
            font-size: 0.9em;
            padding: 8px 0;
            margin-top: 8px;
        }

        .more-toggle:hover {
            text-decoration: underline;
        }

        .category-calendars {
            display: none;
            border-top: 1px solid #eee;
            margin-top: 8px;
            padding-top: 8px;
        }

        .category-calendars.show {
            display: block;
        }

        /* Calendar Preview Section */
        .preview-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }

        .preview-section h2 {
            font-size: 1.1em;
            color: #2c3e50;
            margin: 0 0 16px;
        }

        .view-tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 16px;
        }

        .view-tab {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.2s;
        }

        .view-tab:first-child { border-radius: 6px 0 0 6px; }
        .view-tab:last-child { border-radius: 0 6px 6px 0; }

        .view-tab.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .calendar-preview {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        /* Month navigation */
        .month-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: #f8f9fa;
            border-bottom: 1px solid #eee;
        }

        .month-nav button {
            background: none;
            border: 1px solid #ddd;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
        }

        .month-nav button:hover { background: #eee; }

        .month-nav .month-label {
            font-weight: 600;
            color: #2c3e50;
        }

        /* List view */
        .list-view {
            max-height: 400px;
            overflow-y: auto;
        }

        .event-day {
            border-bottom: 1px solid #eee;
        }

        .event-day:last-child { border-bottom: none; }

        .day-header {
            background: #f8f9fa;
            padding: 8px 16px;
            font-weight: 600;
            font-size: 0.85em;
            color: #555;
            position: sticky;
            top: 0;
        }

        .event-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 16px;
            border-bottom: 1px solid #f0f0f0;
        }

        .event-item:last-child { border-bottom: none; }

        .event-color {
            width: 4px;
            min-height: 36px;
            border-radius: 2px;
            flex-shrink: 0;
        }

        .event-details {
            flex: 1;
            min-width: 0;
        }

        .event-title {
            font-weight: 500;
            font-size: 0.9em;
            color: #333;
            margin-bottom: 2px;
        }

        .event-meta {
            font-size: 0.8em;
            color: #666;
        }

        .event-time {
            color: #888;
        }

        /* Grid view */
        .grid-view {
            display: none;
            width: 100%;
            overflow-x: auto;
        }

        .grid-view.active { display: block; }
        .list-view.active { display: block; }
        .list-view { display: none; }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, minmax(0, 1fr));
            width: 100%;
            min-width: 100%;
        }

        .grid-header {
            background: #f8f9fa;
            padding: 8px 2px;
            text-align: center;
            font-size: 0.75em;
            font-weight: 600;
            color: #666;
            border-bottom: 1px solid #eee;
            min-width: 0;
        }

        .grid-day {
            min-height: 70px;
            border-right: 1px solid #eee;
            border-bottom: 1px solid #eee;
            padding: 3px;
            font-size: 0.75em;
            min-width: 0;
            overflow: hidden;
        }

        .grid-day:nth-child(7n) { border-right: none; }

        .grid-day.other-month {
            background: #fafafa;
            color: #bbb;
        }

        .grid-day.today {
            background: #e8f4fc;
        }

        .day-number {
            font-weight: 600;
            margin-bottom: 4px;
            color: #555;
        }

        .grid-day.other-month .day-number { color: #ccc; }

        .grid-event {
            background: var(--peer-support);
            color: white;
            padding: 2px 4px;
            border-radius: 2px;
            margin-bottom: 2px;
            font-size: 0.7em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
        }

        .grid-event:hover {
            opacity: 0.9;
        }

        .more-events {
            color: #666;
            font-size: 0.7em;
            cursor: pointer;
        }

        .no-events {
            padding: 40px 20px;
            text-align: center;
            color: #888;
        }

        @media (max-width: 600px) {
            .grid-day { min-height: 60px; }
            .grid-event { display: none; }
            .day-number.has-events::after {
                content: '';
                display: inline-block;
                width: 6px;
                height: 6px;
                background: var(--accent);
                border-radius: 50%;
                margin-left: 4px;
            }
        }

        /* Updates section */
        .updates-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }

        .updates-section h2 {
            font-size: 1em;
            color: #555;
            margin: 0 0 12px;
        }

        .updates-list {
            list-style: none;
            padding: 0;
            margin: 0;
            font-size: 0.85em;
            color: #666;
        }

        .updates-list li {
            padding: 6px 0;
            border-bottom: 1px solid #eee;
        }

        .updates-list li:last-child {
            border-bottom: none;
        }

        .update-date {
            font-weight: 500;
            color: #444;
            margin-right: 8px;
        }

        footer {
            margin-top: 30px;
            text-align: center;
            color: #888;
            font-size: 0.85em;
        }
    </style>
</head>
<body>
    <header>
        <img src="folktime-logo.png" alt="FolkTime Logo">
        <h1>Peer Support Calendar</h1>
        <p class="tagline">Free activities in the Tri-County area</p>
    </header>

    <main>
        <div class="how-it-works">
            <p><strong>Subscribe once, stay updated.</strong> When you add this calendar, new events appear automatically — no need to re-download or check back.</p>
        </div>

        <p class="choose-label">Which calendar app do you use?</p>
        <div class="platform-tabs">
            <button class="platform-tab active" data-platform="apple">Apple Calendar</button>
            <button class="platform-tab" data-platform="google">Google Calendar</button>
            <button class="platform-tab" data-platform="outlook">Outlook</button>
        </div>

        <div class="calendar-section">
            <ul class="calendar-list">
                <li>
                    <div class="calendar-info">
                        <span class="color-dot" style="background: #333;"></span>
                        <span class="calendar-name">All Events</span>
                    </div>
                    <button class="copy-btn" data-file="all-events.ics">Subscribe</button>
                </li>
            </ul>

            <button class="more-toggle">+ Show category calendars</button>

            <ul class="calendar-list category-calendars">
                <li>
                    <div class="calendar-info">
                        <span class="color-dot" style="background: var(--peer-support);"></span>
                        <span class="calendar-name">Peer Support</span>
                    </div>
                    <button class="copy-btn" data-file="peer_support.ics">Subscribe</button>
                </li>
                <li>
                    <div class="calendar-info">
                        <span class="color-dot" style="background: var(--fitness);"></span>
                        <span class="calendar-name">Fitness & Wellness</span>
                    </div>
                    <button class="copy-btn" data-file="fitness_wellness.ics">Subscribe</button>
                </li>
                <li>
                    <div class="calendar-info">
                        <span class="color-dot" style="background: var(--events);"></span>
                        <span class="calendar-name">Events & Festivals</span>
                    </div>
                    <button class="copy-btn" data-file="events.ics">Subscribe</button>
                </li>
                <li>
                    <div class="calendar-info">
                        <span class="color-dot" style="background: var(--arts);"></span>
                        <span class="calendar-name">Arts & Culture</span>
                    </div>
                    <button class="copy-btn" data-file="arts_culture.ics">Subscribe</button>
                </li>
                <li>
                    <div class="calendar-info">
                        <span class="color-dot" style="background: var(--social);"></span>
                        <span class="calendar-name">Social Activities</span>
                    </div>
                    <button class="copy-btn" data-file="social_activities.ics">Subscribe</button>
                </li>
                <li>
                    <div class="calendar-info">
                        <span class="color-dot" style="background: var(--food);"></span>
                        <span class="calendar-name">Food & Farms</span>
                    </div>
                    <button class="copy-btn" data-file="food_farms.ics">Subscribe</button>
                </li>
            </ul>

            <div class="instructions" id="instructions-apple">
                <strong>How to subscribe:</strong>
                <ol>
                    <li>Tap "Subscribe" to copy the link</li>
                    <li>On iPhone/iPad: Settings &gt; Calendar &gt; Accounts &gt; Add Account &gt; Other &gt; Add Subscribed Calendar</li>
                    <li>On Mac: File &gt; New Calendar Subscription</li>
                    <li>Paste the link — events will sync automatically</li>
                </ol>
            </div>

            <div class="instructions" id="instructions-google" style="display: none;">
                <strong>How to subscribe:</strong>
                <ol>
                    <li>Click "Subscribe" to copy the link</li>
                    <li>Go to <a href="https://calendar.google.com" target="_blank">calendar.google.com</a></li>
                    <li>Click + next to "Other calendars" &gt; From URL</li>
                    <li>Paste the link — events will sync automatically</li>
                </ol>
            </div>

            <div class="instructions" id="instructions-outlook" style="display: none;">
                <strong>How to subscribe:</strong>
                <ol>
                    <li>Click "Subscribe" to copy the link</li>
                    <li>In Outlook: Add calendar &gt; Subscribe from web</li>
                    <li>Paste the link — events will sync automatically</li>
                </ol>
            </div>
        </div>

        <div class="preview-section">
            <h2>Preview Events</h2>
            <div class="view-tabs">
                <button class="view-tab active" data-view="list">List</button>
                <button class="view-tab" data-view="grid">Calendar</button>
            </div>
            <div class="calendar-preview">
                <div class="month-nav">
                    <button id="prev-month">&larr; Prev</button>
                    <span class="month-label" id="month-label">January 2025</span>
                    <button id="next-month">Next &rarr;</button>
                </div>
                <div class="list-view active" id="list-view">
                    <div class="no-events">Loading events...</div>
                </div>
                <div class="grid-view" id="grid-view">
                    <div class="calendar-grid" id="calendar-grid"></div>
                </div>
            </div>
        </div>

        <div class="updates-section">
            <h2>Updates</h2>
            <ul class="updates-list">
                <li><span class="update-date">Jan 7, 2025</span> Added CMHC Peer Groups: ColorFlow, Intentional Silence & Meditation, Cultivate & Connect, Healing with Photography, Karaoke Night</li>
            </ul>
        </div>
    </main>

    <footer>
        <p>Maintained by FolkTime</p>
    </footer>

    <script>
        const baseUrl = window.location.href.replace(/index\.html$/, '').replace(/\/$/, '') + '/';
        let currentPlatform = 'apple';

        // Platform tab switching
        document.querySelectorAll('.platform-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.platform-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                currentPlatform = this.dataset.platform;

                // Update instructions
                document.querySelectorAll('.instructions').forEach(i => i.style.display = 'none');
                document.getElementById('instructions-' + currentPlatform).style.display = 'block';
            });
        });

        // Copy button functionality
        document.querySelectorAll('.copy-btn').forEach(btn => {
            btn.addEventListener('click', async function() {
                const file = this.dataset.file;
                const fullUrl = baseUrl + currentPlatform + '/' + file;

                try {
                    await navigator.clipboard.writeText(fullUrl);
                } catch (err) {
                    const textarea = document.createElement('textarea');
                    textarea.value = fullUrl;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                }

                this.textContent = 'Link copied!';
                this.classList.add('copied');
                setTimeout(() => {
                    this.textContent = 'Subscribe';
                    this.classList.remove('copied');
                }, 2000);
            });
        });

        // Toggle category calendars
        document.querySelector('.more-toggle').addEventListener('click', function() {
            const categories = document.querySelector('.category-calendars');
            const isShown = categories.classList.toggle('show');
            this.textContent = isShown ? '− Hide category calendars' : '+ Show category calendars';
        });

        // Calendar Preview functionality
        let eventsData = null;
        let currentMonth = new Date();
        let currentView = 'list';

        const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                           'July', 'August', 'September', 'October', 'November', 'December'];

        // Parse schedule strings like "1st & 3rd Wednesdays, 2-3:30pm"
        function parseSchedule(schedule) {
            if (!schedule) return null;

            const result = { ordinals: [], day: null, startTime: null, endTime: null, weekly: false };
            const lower = schedule.toLowerCase();

            // Find day of week
            const days = { 'sunday': 0, 'monday': 1, 'tuesday': 2, 'wednesday': 3,
                          'thursday': 4, 'friday': 5, 'saturday': 6,
                          'sundays': 0, 'mondays': 1, 'tuesdays': 2, 'wednesdays': 3,
                          'thursdays': 4, 'fridays': 5, 'saturdays': 6 };
            for (const [name, num] of Object.entries(days)) {
                if (lower.includes(name)) {
                    result.day = num;
                    break;
                }
            }

            // Find ordinals (1st, 2nd, 3rd, 4th)
            const ordinalMatch = lower.match(/(\d+)(?:st|nd|rd|th)/g);
            if (ordinalMatch) {
                result.ordinals = ordinalMatch.map(o => parseInt(o));
            }

            // Check for "every" (weekly)
            if (lower.includes('every')) {
                result.weekly = true;
            }

            // Parse time
            const timeMatch = schedule.match(/(\d{1,2})(?::(\d{2}))?\s*-\s*(\d{1,2})(?::(\d{2}))?\s*(am|pm)?/i);
            if (timeMatch) {
                let startHour = parseInt(timeMatch[1]);
                const startMin = timeMatch[2] ? parseInt(timeMatch[2]) : 0;
                let endHour = parseInt(timeMatch[3]);
                const endMin = timeMatch[4] ? parseInt(timeMatch[4]) : 0;
                const period = timeMatch[5]?.toLowerCase();

                if (period === 'pm') {
                    if (startHour < 12) startHour += 12;
                    if (endHour < 12) endHour += 12;
                }

                result.startTime = `${startHour}:${startMin.toString().padStart(2, '0')}`;
                result.endTime = `${endHour}:${endMin.toString().padStart(2, '0')}`;
            }

            return result;
        }

        // Get dates for a schedule in a given month
        function getScheduleDates(schedule, year, month) {
            const parsed = parseSchedule(schedule);
            if (!parsed || parsed.day === null) return [];

            const dates = [];
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);

            // Find all occurrences of the day in this month
            let date = new Date(firstDay);
            let weekOfMonth = 0;
            let lastWeekNum = -1;

            while (date <= lastDay) {
                if (date.getDay() === parsed.day) {
                    const weekNum = Math.floor((date.getDate() - 1) / 7) + 1;

                    if (parsed.weekly || parsed.ordinals.includes(weekNum)) {
                        dates.push({
                            date: new Date(date),
                            startTime: parsed.startTime,
                            endTime: parsed.endTime
                        });
                    }
                }
                date.setDate(date.getDate() + 1);
            }

            return dates;
        }

        // Generate all events for a month
        function generateMonthEvents(year, month) {
            if (!eventsData) return [];

            const events = [];

            for (const entry of eventsData.events) {
                // Handle programs with schedules
                if (entry.programs && entry.programs.length > 0) {
                    for (const program of entry.programs) {
                        if (program.schedule) {
                            const dates = getScheduleDates(program.schedule, year, month);
                            for (const d of dates) {
                                events.push({
                                    title: program.name || entry.title,
                                    org: entry.title,
                                    date: d.date,
                                    startTime: d.startTime,
                                    endTime: d.endTime,
                                    color: entry.color,
                                    category: entry.categoryName,
                                    location: program.location || entry.address,
                                    format: program.format
                                });
                            }
                        }
                    }
                }

                // Handle direct schedule on entry
                if (entry.schedule && !entry.programs?.length) {
                    const dates = getScheduleDates(entry.schedule, year, month);
                    for (const d of dates) {
                        events.push({
                            title: entry.title,
                            org: null,
                            date: d.date,
                            startTime: d.startTime,
                            endTime: d.endTime,
                            color: entry.color,
                            category: entry.categoryName,
                            location: entry.address
                        });
                    }
                }
            }

            // Sort by date and time
            events.sort((a, b) => {
                const dateCompare = a.date - b.date;
                if (dateCompare !== 0) return dateCompare;
                return (a.startTime || '').localeCompare(b.startTime || '');
            });

            return events;
        }

        // Format time for display
        function formatTime(time) {
            if (!time) return '';
            const [hour, min] = time.split(':').map(Number);
            const period = hour >= 12 ? 'pm' : 'am';
            const displayHour = hour > 12 ? hour - 12 : (hour === 0 ? 12 : hour);
            return min > 0 ? `${displayHour}:${min.toString().padStart(2, '0')}${period}` : `${displayHour}${period}`;
        }

        // Render list view
        function renderListView() {
            const container = document.getElementById('list-view');
            const events = generateMonthEvents(currentMonth.getFullYear(), currentMonth.getMonth());

            if (events.length === 0) {
                container.innerHTML = '<div class="no-events">No scheduled events this month</div>';
                return;
            }

            // Group by date
            const grouped = {};
            for (const event of events) {
                const key = event.date.toDateString();
                if (!grouped[key]) grouped[key] = [];
                grouped[key].push(event);
            }

            let html = '';
            for (const [dateStr, dayEvents] of Object.entries(grouped)) {
                const date = new Date(dateStr);
                const dayName = dayNames[date.getDay()];
                const monthDay = `${monthNames[date.getMonth()]} ${date.getDate()}`;

                html += `<div class="event-day">
                    <div class="day-header">${dayName}, ${monthDay}</div>`;

                for (const event of dayEvents) {
                    const timeStr = event.startTime ?
                        `${formatTime(event.startTime)}${event.endTime ? ' - ' + formatTime(event.endTime) : ''}` : '';
                    const locationStr = event.format === 'Zoom' ? 'Online (Zoom)' : (event.location || '');

                    html += `<div class="event-item">
                        <div class="event-color" style="background: ${event.color}"></div>
                        <div class="event-details">
                            <div class="event-title">${event.title}</div>
                            <div class="event-meta">
                                ${timeStr ? `<span class="event-time">${timeStr}</span>` : ''}
                                ${timeStr && locationStr ? ' · ' : ''}
                                ${locationStr}
                            </div>
                        </div>
                    </div>`;
                }

                html += '</div>';
            }

            container.innerHTML = html;
        }

        // Render grid view
        function renderGridView() {
            const container = document.getElementById('calendar-grid');
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startOffset = firstDay.getDay();

            const events = generateMonthEvents(year, month);
            const eventsByDate = {};
            for (const event of events) {
                const key = event.date.getDate();
                if (!eventsByDate[key]) eventsByDate[key] = [];
                eventsByDate[key].push(event);
            }

            const today = new Date();
            const isCurrentMonth = today.getFullYear() === year && today.getMonth() === month;

            let html = dayNames.map(d => `<div class="grid-header">${d}</div>`).join('');

            // Previous month days
            const prevMonth = new Date(year, month, 0);
            for (let i = startOffset - 1; i >= 0; i--) {
                html += `<div class="grid-day other-month"><div class="day-number">${prevMonth.getDate() - i}</div></div>`;
            }

            // Current month days
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const isToday = isCurrentMonth && today.getDate() === day;
                const dayEvents = eventsByDate[day] || [];
                const hasEvents = dayEvents.length > 0;

                html += `<div class="grid-day${isToday ? ' today' : ''}">
                    <div class="day-number${hasEvents ? ' has-events' : ''}">${day}</div>`;

                const maxShow = 2;
                for (let i = 0; i < Math.min(dayEvents.length, maxShow); i++) {
                    const evt = dayEvents[i];
                    html += `<div class="grid-event" style="background: ${evt.color}" title="${evt.title}">${evt.title}</div>`;
                }

                if (dayEvents.length > maxShow) {
                    html += `<div class="more-events">+${dayEvents.length - maxShow} more</div>`;
                }

                html += '</div>';
            }

            // Next month days
            const totalCells = startOffset + lastDay.getDate();
            const remaining = (7 - (totalCells % 7)) % 7;
            for (let i = 1; i <= remaining; i++) {
                html += `<div class="grid-day other-month"><div class="day-number">${i}</div></div>`;
            }

            container.innerHTML = html;
        }

        // Update display
        function updateCalendarDisplay() {
            document.getElementById('month-label').textContent =
                `${monthNames[currentMonth.getMonth()]} ${currentMonth.getFullYear()}`;

            renderListView();
            renderGridView();
        }

        // View tab switching
        document.querySelectorAll('.view-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.view-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');

                currentView = this.dataset.view;
                document.getElementById('list-view').classList.toggle('active', currentView === 'list');
                document.getElementById('grid-view').classList.toggle('active', currentView === 'grid');
            });
        });

        // Month navigation
        document.getElementById('prev-month').addEventListener('click', () => {
            currentMonth.setMonth(currentMonth.getMonth() - 1);
            updateCalendarDisplay();
        });

        document.getElementById('next-month').addEventListener('click', () => {
            currentMonth.setMonth(currentMonth.getMonth() + 1);
            updateCalendarDisplay();
        });

        // Load events data
        fetch(baseUrl + 'events.json')
            .then(res => res.json())
            .then(data => {
                eventsData = data;
                updateCalendarDisplay();
            })
            .catch(err => {
                document.getElementById('list-view').innerHTML =
                    '<div class="no-events">Could not load events</div>';
            });
    </script>
</body>
</html>
